# 7장 고급 매핑





### 상속관계 매핑



관계형 데이터베이스에는 객체지향 언어에서 다루는 상속이라는 개념이 없다.

그나마 유사한 형태의 모델은 **슈퍼타입 서브타입 관계** 모델이다.



##### 슈퍼타입 서브타입을 매핑하는 방법

- 각각의 테이블로 변환
  - 슈퍼타입에 해당하는 테이블을 만들고, 각각의 서브타입에 해당하는 테이블을 만들어 **조인 을 사용하여 해결한다.** JPA에서는 조인전략이라고 한다.
- 통합 테이블로 변환
  - 하나의 테이블에 DTYPE (타입 플래그) 값을 이용해 테이블을 하나만 사용해서 해결한다. JPA에서는 단일 테이블 전략이라고 한다.
- 서브타입 테이블로 변환
  - 서브 타입마다 하나의 테이블을 만들어 해결한다. JPA에서는 구현 클래스마다 테이블 전략이라 한다.



#### 조인 전략



조인 전략은 엔티티 각각을 모두 테이블로 만들고, **자식 테이블이 부모 테이블의 기본키를 받아 기본키 + 외래 키로 사용하는 전략**이다.



````java
@Entity
@Inheritance(strategy = InheritanceType.JOINED)
@DiscriminatorColumn(name = "DTYPE")
public abstract class Item {
  
	@Id @GeneratedValue
  @Column(name = "ITEM_ID")
  private Long id;
  
  private String name;
  private int price;
  ...
}

@Entity
@DiscriminatorValue("A")
public class Album extends Item {
  private String artist;
  ...
}

@Entity
@DiscriminatorValue("M")
public class Movie extends Item {
  private String director;
  private String actor;
  ...
}
````





- @Inheritance(strategy = InheritanceType.JOINED)
  - 상속 매핑은 부모클래스에 @Inheritance 애노테이션을 사용해야한다.
  - 매핑전략을 JOIN 전략으로 지정한다.
- @DiscriminatorColumn(name = "DTYPE")
  - 부모 클래스에 구분 컬럼을 지정한다.
  - 기본값은 DTYPE 이다.
- @DiscriminatorValue("A")
  - 엔티티를 저장할때 구분 컬럼에 입력할 값을 지정한다.
  - 기본값은 엔티티의 이름이다.



> 이 전략을 사용하면, 자식 테이블은 부모 테이블의 ID 컬럼명을 그대로 사용하는데, 만약 자식 테이블의 기본 키 컬럼명을 변경하고 싶다면 **@PrimaryKeyJoinColumn(name = "사용할 컬럼명")** 애노테이션을 사용하면 된다.





- 정규화된 테이블을 사용하기 때문에 저장공간을 효율적으로 사용한다.
- 조회 쿼리가 복잡해지고, 조인을 사용하기 때문에 성능이 저하될 수 있다.
- 커맨드성 SQL이 두번 발생한다.
